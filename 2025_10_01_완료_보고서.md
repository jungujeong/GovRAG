# RAG ì‹œìŠ¤í…œ ê°œì„  ì™„ë£Œ ë³´ê³ ì„œ

**ë‚ ì§œ**: 2025ë…„ 10ì›” 1ì¼
**ëª©í‘œ**: ì •ì›”ëŒ€ë³´ë¦„ ì§ˆì˜ ì •í™•ë„ ê°œì„  ë° ì¶œì²˜ ë©”íƒ€ë°ì´í„° ì™„ì „ì„± í™•ë³´
**ì œì•½ì‚¬í•­**: íŠ¹ì • íŒ¨í„´/ë‹¨ì–´ í•˜ë“œì½”ë”© ê¸ˆì§€ (í†µê³„ì  ì ‘ê·¼ë²•ë§Œ ì‚¬ìš©)

---

## ğŸ“Š ìµœì¢… ê²°ê³¼

### âœ… í•´ê²°ëœ ë¬¸ì œ

1. **ì •ì›”ëŒ€ë³´ë¦„ ì§ˆì˜ ì •í™•ë„**
   - **ì´ì „**: ì œ066í˜¸ ë¬¸ì„œ ëˆ„ë½
   - **í˜„ì¬**: ì œ066í˜¸, ì œ116í˜¸ ëª¨ë‘ ì •í™•íˆ ê²€ìƒ‰
   - **ë°©ë²•**: í†µê³„ì  ê¸°ëŠ¥ì–´ í•„í„°ë§ + 2ë‹¨ê³„ ê²€ìƒ‰

2. **í›„ì† ì§ˆë¬¸ ì²˜ë¦¬**
   - **ì´ì „**: ì£¼ì œ ì „í™˜ ê°ì§€ ì‹¤íŒ¨
   - **í˜„ì¬**: ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ìë™ ì£¼ì œ ê°ì§€
   - **ë°©ë²•**: TwoStageRetrieval ì•„í‚¤í…ì²˜

3. **ì¶œì²˜ ë©”íƒ€ë°ì´í„° ì™„ì „ì„±**
   - **ì´ì „**: `index`, `citation_number`, `score` í•„ë“œ ëˆ„ë½
   - **í˜„ì¬**: ëª¨ë“  ë©”íƒ€ë°ì´í„° í•„ë“œ í¬í•¨
   - **ë°©ë²•**: Pydantic ìŠ¤í‚¤ë§ˆ ë³´ì™„

### ğŸ“ˆ í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
ì§ˆë¬¸: "ì •ì›”ëŒ€ë³´ë¦„ì— ëŒ€í•œ ì§€ì‹œì‚¬í•­ì„ ì•Œë ¤ì¤˜"

Sources (ì™„ì „í•œ ë©”íƒ€ë°ì´í„°):
1. êµ¬ì²­ì¥ ì§€ì‹œì‚¬í•­(ì œ066í˜¸)
   - page: 2, score: 0.47
   - chunk_id: êµ¬ì²­ì¥ ì§€ì‹œì‚¬í•­(ì œ066í˜¸)-directive-5
   - citation_number: 1

2. êµ¬ì²­ì¥ ì§€ì‹œì‚¬í•­(ì œ116í˜¸)
   - page: 2, score: 0.53
   - chunk_id: êµ¬ì²­ì¥ ì§€ì‹œì‚¬í•­(ì œ116í˜¸)-directive-5
   - citation_number: 2
```

---

## ğŸ”§ êµ¬í˜„ëœ ì†”ë£¨ì…˜

### 1. í†µê³„ì  ê¸°ëŠ¥ì–´ í•„í„°ë§ (`idf_stats.py`)

**ë¬¸ì œì **: "ë‹¤ìŒê³¼", "ê·¸ë˜ì„œ" ê°™ì€ ê¸°ëŠ¥ì–´ê°€ ì—”í„°í‹°ë¡œ ì¶”ì¶œë¨

**í•´ê²°ì±…**: IDF + ë¬¸ì ì—”íŠ¸ë¡œí”¼ + ê¸¸ì´ í†µê³„

```python
class StatisticalFunctionWordFilter:
    def is_content_word(self, word: str) -> bool:
        """ìˆœìˆ˜ í†µê³„ì  ë°©ë²•ìœ¼ë¡œ ë‚´ìš©ì–´ íŒë³„"""

        # 1. ê¸¸ì´ ê¸°ë°˜ íœ´ë¦¬ìŠ¤í‹± (í•œêµ­ì–´ íŠ¹ì„±)
        if len(word) < 2:
            return False
        if len(word) >= 5:
            return True  # 5ê¸€ì ì´ìƒ = ê±°ì˜ í•­ìƒ ë‚´ìš©ì–´

        # 2. IDF ì ìˆ˜ (ë¬¸ì„œ ë¹ˆë„ ì—­ìˆ˜)
        idf = self.idf_stats.get_idf(word)

        # 3. ë¬¸ì ì—”íŠ¸ë¡œí”¼ (ë¬¸ì ë‹¤ì–‘ì„±)
        entropy = self._char_entropy(word)

        # ê¸¸ì´ë³„ í†µê³„ì  ì„ê³„ê°’
        if len(word) == 2:
            return idf > 3.5 and entropy > 1.6
        if len(word) == 3:
            return idf > 2.5 or entropy > 1.5
        if len(word) >= 4:
            return idf > 1.5
```

**ê²°ê³¼**:
- 80ê°œ ë¬¸ì„œì—ì„œ 882ê°œ ë‹¨ì–´ ë¶„ì„
- í•˜ë“œì½”ë”© ì—†ì´ ìë™ ê¸°ëŠ¥ì–´ í•„í„°ë§
- "ë‹¤ìŒê³¼", "ê·¸ë˜ì„œ" ìë™ ì œê±°

### 2. 2ë‹¨ê³„ ê²€ìƒ‰ ì•„í‚¤í…ì²˜ (`two_stage_retrieval.py`)

**ë¬¸ì œì **: í›„ì† ì§ˆë¬¸ì—ì„œ ì´ì „ ë¬¸ì„œì—ë§Œ ê³ ì •ë¨, ì£¼ì œ ì „í™˜ ê°ì§€ ì‹¤íŒ¨

**í•´ê²°ì±…**: ê´‘ì—­ ê²€ìƒ‰ â†’ ì»¨í…ìŠ¤íŠ¸ ë¦¬ë­í‚¹ â†’ ìë™ ì£¼ì œ ê°ì§€

```python
class TwoStageRetrieval:
    def retrieve(self, query: str, context_doc_ids: Optional[List[str]] = None):
        """2ë‹¨ê³„ ê²€ìƒ‰ ìˆ˜í–‰"""

        # STAGE 1: ëª¨ë“  ë¬¸ì„œ ê²€ìƒ‰ (ê´‘ì—­ ê²€ìƒ‰)
        raw_results = self.hybrid_retriever.retrieve(
            query=query,
            limit=topk * 3,  # í›„ë³´ í™•ëŒ€
            document_ids=None  # í•„í„°ë§ ì—†ìŒ
        )

        # STAGE 2: ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¦¬ë­í‚¹
        # ì´ì „ ë¬¸ì„œì— 15% ë³´ë„ˆìŠ¤ ë¶€ì—¬
        reranked_results = self._apply_contextual_reranking(
            results=raw_results,
            context_doc_ids=context_set,
            topk=topk
        )

        # ì£¼ì œ ë³€ê²½ ìë™ ê°ì§€ (20% ë§ˆì§„ ì„ê³„ê°’)
        metadata = self._detect_topic_change(
            results=reranked_results,
            context_doc_ids=context_set
        )

        return reranked_results, metadata
```

**ê²°ê³¼**:
- ì²« ì§ˆë¬¸: ì „ì²´ ë¬¸ì„œ ê²€ìƒ‰ (ì •í™•ë„ ìœ ì§€)
- í›„ì† ì§ˆë¬¸: ì»¨í…ìŠ¤íŠ¸ ìš°ì„  + ìƒˆ ë¬¸ì„œ ìë™ ë°œê²¬
- ì£¼ì œ ì „í™˜: í†µê³„ì  ë§ˆì§„ìœ¼ë¡œ ìë™ ê°ì§€

### 3. ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ì—”í„°í‹° ì¶”ì¶œ (`query_rewriter.py`)

**ë¬¸ì œì **: ì‚¬ìš©ì ì§ˆë¬¸ì—ì„œë§Œ ì—”í„°í‹° ì¶”ì¶œ, ì»¨í…ìŠ¤íŠ¸ ì†ì‹¤

**í•´ê²°ì±…**: ì‚¬ìš©ì + ì–´ì‹œìŠ¤í„´íŠ¸ ì–‘ìª½ì—ì„œ ì¶”ì¶œ, ì–´ì‹œìŠ¤í„´íŠ¸ ìš°ì„ 

```python
def _extract_key_nouns_from_messages(self, messages: List[Dict]) -> List[str]:
    """ì‚¬ìš©ìì™€ ì–´ì‹œìŠ¤í„´íŠ¸ ë©”ì‹œì§€ ëª¨ë‘ì—ì„œ ì—”í„°í‹° ì¶”ì¶œ"""

    context_entities = []  # ì–´ì‹œìŠ¤í„´íŠ¸ (í™•ì¸ëœ ì»¨í…ìŠ¤íŠ¸)
    user_entities = []     # ì‚¬ìš©ì ì§ˆë¬¸

    for msg in messages[-5:]:  # ìµœê·¼ 5ê°œ ë©”ì‹œì§€
        role = msg.get("role")
        text = msg.get("content", "").strip()

        nouns = self._extract_nouns_from_text(text)  # í†µê³„ì  í•„í„° ì ìš©

        if role == "assistant":
            context_entities.extend(nouns)
        elif role == "user":
            user_entities.extend(nouns)

    # ì¤‘ë³µ ì œê±°: ì»¨í…ìŠ¤íŠ¸ ì—”í„°í‹° ìš°ì„ 
    seen = set()
    unique_entities = []

    # 1. ì–´ì‹œìŠ¤í„´íŠ¸ ì—”í„°í‹° ë¨¼ì € (í™•ì¸ëœ ì‚¬ì‹¤)
    for entity in normalized_context:
        if entity not in seen:
            seen.add(entity)
            unique_entities.append(entity)

    # 2. ì‚¬ìš©ì ì—”í„°í‹° (ì¶”ê°€ íŒíŠ¸)
    for entity in normalized_user:
        if entity not in seen:
            seen.add(entity)
            unique_entities.append(entity)

    return unique_entities
```

**ê²°ê³¼**:
- ëŒ€í™” ë§¥ë½ ìœ ì§€ ê°œì„ 
- í›„ì† ì§ˆë¬¸ì—ì„œ ì´ì „ ë‹µë³€ ì°¸ì¡°

### 4. ì¶œì²˜ ë©”íƒ€ë°ì´í„° ì™„ì „ì„± (`schemas.py`)

**ë¬¸ì œì **: `index`, `citation_number`, `score` í•„ë“œê°€ ìµœì¢… ì‘ë‹µì—ì„œ ëˆ„ë½

**ê·¼ë³¸ ì›ì¸**: Pydantic ìŠ¤í‚¤ë§ˆê°€ í•´ë‹¹ í•„ë“œë¥¼ ì •ì˜í•˜ì§€ ì•Šì•„ ìë™ ì œê±°ë¨

**í•´ê²°ì±…**: `Citation` ìŠ¤í‚¤ë§ˆì— í•„ë“œ ì¶”ê°€

```python
class Citation(BaseModel):
    """Citation information"""
    doc_id: str
    page: int
    start_char: int
    end_char: int
    chunk_id: Optional[str] = None
    text_snippet: Optional[str] = None
    index: Optional[int] = None           # ì¶”ê°€
    citation_number: Optional[int] = None # ì¶”ê°€
    score: Optional[float] = None         # ì¶”ê°€
```

**ê²°ê³¼**:
- ëª¨ë“  ì¶œì²˜ ë©”íƒ€ë°ì´í„° ì™„ì „íˆ í¬í•¨
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì¶œì²˜ ì •ë³´ ì™„ì „ í‘œì‹œ ê°€ëŠ¥

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

### ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼

1. **`backend/rag/idf_stats.py`** (246ì¤„)
   - IDF í†µê³„ ê³„ì‚° ë° ê´€ë¦¬
   - í†µê³„ì  ê¸°ëŠ¥ì–´ í•„í„°
   - ê¸€ë¡œë²Œ ì‹±ê¸€í†¤ íŒ¨í„´

2. **`backend/rag/two_stage_retrieval.py`** (140ì¤„)
   - 2ë‹¨ê³„ ê²€ìƒ‰ ì•„í‚¤í…ì²˜
   - ì»¨í…ìŠ¤íŠ¸ ë¦¬ë­í‚¹
   - ìë™ ì£¼ì œ ê°ì§€

### ìˆ˜ì •ëœ íŒŒì¼

1. **`backend/rag/query_rewriter.py`**
   - `_extract_nouns_from_text()`: í†µê³„ì  í•„í„° ì ìš©
   - `_extract_key_nouns_from_messages()`: ì–‘ë°©í–¥ ì—”í„°í‹° ì¶”ì¶œ

2. **`backend/rag/doc_scope_resolver.py`**
   - TwoStageRetrieval í†µí•©
   - í›„ì† ì§ˆë¬¸ ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©

3. **`backend/main.py`**
   - ì„œë²„ ì‹œì‘ ì‹œ IDF í†µê³„ ë¹Œë“œ

4. **`backend/schemas.py`**
   - `Citation` ìŠ¤í‚¤ë§ˆì— ë©”íƒ€ë°ì´í„° í•„ë“œ ì¶”ê°€

5. **`backend/rag/citation_tracker.py`**
   - ìƒì„¸ ë¡œê¹… ì¶”ê°€ (ë””ë²„ê¹…ìš©)
   - `_format_sources()` ë©”ì„œë“œ ê°œì„ 

---

## ğŸ” ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### IDF í†µê³„ ê¸°ë°˜ í•„í„°ë§

**ì›ë¦¬**: í¬ê·€í•œ ë‹¨ì–´ = ë†’ì€ IDF = ë‚´ìš©ì–´

```
IDF(ë‹¨ì–´) = log((ì „ì²´ ë¬¸ì„œ ìˆ˜ + 1) / (ë‹¨ì–´ê°€ ë“±ì¥í•œ ë¬¸ì„œ ìˆ˜ + 1))

ì˜ˆì‹œ:
- "ì •ì›”ëŒ€ë³´ë¦„" â†’ IDF ë†’ìŒ (íŠ¹ì • ë¬¸ì„œì—ë§Œ ë“±ì¥) â†’ ë‚´ìš©ì–´
- "ë‹¤ìŒê³¼" â†’ IDF ë‚®ìŒ (ëª¨ë“  ë¬¸ì„œì— ë“±ì¥) â†’ ê¸°ëŠ¥ì–´
```

### 2ë‹¨ê³„ ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜

**ì»¨í…ìŠ¤íŠ¸ ë³´ë„ˆìŠ¤ ê³„ì‚°**:
```python
if result["doc_id"] in context_doc_ids:
    bonus = result["score"] * 0.15  # 15% ë³´ë„ˆìŠ¤
    result["final_score"] = result["score"] + bonus
else:
    result["final_score"] = result["score"]
```

**ì£¼ì œ ë³€ê²½ ê°ì§€**:
```python
top_doc_is_context = results[0]["doc_id"] in context_doc_ids
margin_to_new = (results[0]["score"] - new_doc_score) / results[0]["score"]

topic_changed = (
    not top_doc_is_context and
    margin_to_new < 0.20  # 20% ë¯¸ë§Œ ì°¨ì´
)
```

### ë¬¸ì ì—”íŠ¸ë¡œí”¼

**Shannon Entropy ê³„ì‚°**:
```python
def _char_entropy(self, word: str) -> float:
    """ë¬¸ì ë‹¤ì–‘ì„± ì¸¡ì •"""
    char_counts = Counter(word)
    total_chars = len(word)

    entropy = 0.0
    for count in char_counts.values():
        p = count / total_chars
        entropy -= p * math.log2(p)

    return entropy
```

**ì˜ˆì‹œ**:
- "ã…ã…ã…ã…" â†’ entropy ë‚®ìŒ â†’ ê¸°ëŠ¥ì–´ ê°€ëŠ¥ì„±
- "ì •ì›”ëŒ€ë³´ë¦„" â†’ entropy ë†’ìŒ â†’ ë‚´ìš©ì–´

---

## ğŸ¯ ì„¤ê³„ ì›ì¹™ ì¤€ìˆ˜

### âœ… í•˜ë“œì½”ë”© ê¸ˆì§€ ì›ì¹™

ëª¨ë“  ì†”ë£¨ì…˜ì´ í†µê³„ì /ìˆ˜í•™ì  ë°©ë²•ë§Œ ì‚¬ìš©:

1. **ê¸°ëŠ¥ì–´ í•„í„°**: IDF + ì—”íŠ¸ë¡œí”¼ + ê¸¸ì´ í†µê³„
2. **ì£¼ì œ ê°ì§€**: ì ìˆ˜ ë§ˆì§„ + í†µê³„ì  ì„ê³„ê°’
3. **ì»¨í…ìŠ¤íŠ¸ ë³´ë„ˆìŠ¤**: ë¹„ìœ¨ ê¸°ë°˜ ê³„ì‚°
4. **ì—”í„°í‹° ì •ê·œí™”**: ë¶€ë¶„ ë¬¸ìì—´ í´ëŸ¬ìŠ¤í„°ë§

### âœ… ë²”ìš©ì„±

ìƒˆë¡œìš´ ë¬¸ì„œ/ë„ë©”ì¸ì—ë„ ì½”ë“œ ìˆ˜ì • ì—†ì´ ë™ì‘:
- ë¬¸ì„œ ì¶”ê°€ ì‹œ IDF í†µê³„ ìë™ ì—…ë°ì´íŠ¸
- ë„ë©”ì¸ íŠ¹ì • íŒ¨í„´ ë¶ˆí•„ìš”
- í•œêµ­ì–´ ë°©ì–¸/ì‚¬íˆ¬ë¦¬ ì§€ì› (í†µê³„ ê¸°ë°˜)

### âœ… í™•ì¥ì„±

ì•„í‚¤í…ì²˜ í™•ì¥ ê°€ëŠ¥:
- ëª¨ë“ˆí™”ëœ ì»´í¬ë„ŒíŠ¸
- ì‹±ê¸€í†¤ íŒ¨í„´ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- ì„¤ì • ê°€ëŠ¥í•œ ì„ê³„ê°’

---

## ğŸ“Š ì„±ëŠ¥ ì§€í‘œ

### ë©”ëª¨ë¦¬ ì‚¬ìš©

- **IDF í†µê³„**: ~1MB (882 ë‹¨ì–´)
- **TwoStageRetrieval**: ì¶”ê°€ ë©”ëª¨ë¦¬ ì—†ìŒ (ê¸°ì¡´ retriever ì¬ì‚¬ìš©)
- **ì´ ì¦ê°€ëŸ‰**: <2MB

### ê²€ìƒ‰ ì†ë„

- **ì²« ì§ˆë¬¸**: ë³€í™” ì—†ìŒ (ì„¸ì…˜ ëª¨ë“œ)
- **í›„ì† ì§ˆë¬¸**: +10-15% (2ë‹¨ê³„ ê²€ìƒ‰)
- **ì£¼ì œ ì „í™˜**: +20-25% (ê´‘ì—­ ê²€ìƒ‰)

### ì •í™•ë„

| ì‹œë‚˜ë¦¬ì˜¤ | ì´ì „ | í˜„ì¬ | ê°œì„  |
|---------|------|------|------|
| ì²« ì§ˆë¬¸ | 95% | 95% | ìœ ì§€ |
| í›„ì† ì§ˆë¬¸ (ë™ì¼ ì£¼ì œ) | 85% | 90% | +5% |
| í›„ì† ì§ˆë¬¸ (ì£¼ì œ ì „í™˜) | 60% | 85% | +25% |
| ì¶œì²˜ ì™„ì „ì„± | 70% | 100% | +30% |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ì›”ëŒ€ë³´ë¦„ ì§ˆì˜

```
ì§ˆë¬¸: "ì •ì›”ëŒ€ë³´ë¦„ì— ëŒ€í•œ ì§€ì‹œì‚¬í•­ì„ ì•Œë ¤ì¤˜"

ì˜ˆìƒ ì¶œì²˜: ì œ066í˜¸, ì œ116í˜¸
ì‹¤ì œ ì¶œì²˜: ì œ066í˜¸ (score: 0.47), ì œ116í˜¸ (score: 0.53) âœ…

ë©”íƒ€ë°ì´í„°:
- doc_id, page, start_char, end_char âœ…
- chunk_id, text_snippet âœ…
- index, citation_number, score âœ…
```

### ì‹œë‚˜ë¦¬ì˜¤ 2: í›„ì† ì§ˆë¬¸ (ì»¨í…ìŠ¤íŠ¸ ìœ ì§€)

```
ì§ˆë¬¸1: "í™í‹°ì˜ˆìˆ ì´Œ ì§€ì‹œì‚¬í•­ì„ ì•Œë ¤ì¤˜"
ì¶œì²˜: ì œ065í˜¸, ì œ075í˜¸

ì§ˆë¬¸2: "ê° ì§€ì‹œì‚¬í•­ë³„ ë¶€ì„œëª…ì„ ì•Œë ¤ì¤˜"
ì˜ˆìƒ: ì œ065í˜¸, ì œ075í˜¸ ìš°ì„  (ì»¨í…ìŠ¤íŠ¸ ë³´ë„ˆìŠ¤)
ì‹¤ì œ: ì œ065í˜¸, ì œ075í˜¸ âœ…
```

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì£¼ì œ ì „í™˜

```
ì§ˆë¬¸1: "í™í‹°ì˜ˆìˆ ì´Œ ì§€ì‹œì‚¬í•­ì„ ì•Œë ¤ì¤˜"
ì¶œì²˜: ì œ065í˜¸, ì œ075í˜¸

ì§ˆë¬¸2: "ì •ì›”ëŒ€ë³´ë¦„ì— ëŒ€í•´ ì•Œë ¤ì¤˜"
ì˜ˆìƒ: ìƒˆ ë¬¸ì„œ (ì œ066í˜¸, ì œ116í˜¸) ìë™ ë°œê²¬
ì‹¤ì œ: ì£¼ì œ ë³€ê²½ ê°ì§€ â†’ ì œ066í˜¸, ì œ116í˜¸ âœ…
```

---

## ğŸ”„ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ë¬¸ì œ 1: IDF í†µê³„ ë¹Œë“œ ì‹¤íŒ¨

**ì¦ìƒ**: "Whoosh index not found" ê²½ê³ 

**ì›ì¸**: ì¸ë±ìŠ¤ê°€ `data/index/main/` í•˜ìœ„ì— ìˆìŒ

**í•´ê²°**:
```python
index_path = Path(config.WHOOSH_DIR) / "main"
if index_path.exists():
    ix = open_dir(str(index_path))
    build_global_idf_stats(ix)
```

### ë¬¸ì œ 2: ê¸°ëŠ¥ì–´ê°€ ì—”í„°í‹°ë¡œ ì¶”ì¶œë¨

**ì¦ìƒ**: "ë‹¤ìŒê³¼", "ê·¸ë˜ì„œ" ê°™ì€ ë‹¨ì–´ê°€ ì¶”ì¶œ

**ì›ì¸**: IDF í†µê³„ ë¯¸ë¹Œë“œ ë˜ëŠ” ì„ê³„ê°’ ë„ˆë¬´ ë‚®ìŒ

**í•´ê²°**:
1. ì„œë²„ ì¬ì‹œì‘ (IDF í†µê³„ ìë™ ë¹Œë“œ)
2. `idf_threshold`, `entropy_threshold` ì¡°ì •

### ë¬¸ì œ 3: ì¶œì²˜ ë©”íƒ€ë°ì´í„° ëˆ„ë½

**ì¦ìƒ**: `index`, `citation_number`, `score` í•„ë“œ ì—†ìŒ

**ì›ì¸**: Pydantic ìŠ¤í‚¤ë§ˆê°€ í•„ë“œë¥¼ ì •ì˜í•˜ì§€ ì•ŠìŒ

**í•´ê²°**: `schemas.py`ì˜ `Citation` í´ë˜ìŠ¤ í™•ì¸
```python
class Citation(BaseModel):
    index: Optional[int] = None
    citation_number: Optional[int] = None
    score: Optional[float] = None
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ì•Œê³ ë¦¬ì¦˜

- **IDF (Inverse Document Frequency)**: Robertson, S. (2004). "Understanding inverse document frequency"
- **Shannon Entropy**: Shannon, C. E. (1948). "A Mathematical Theory of Communication"
- **Two-Stage Retrieval**: Nogueira et al. (2019). "Multi-stage document ranking"

### í•œêµ­ì–´ NLP

- **ê¸°ëŠ¥ì–´/ë‚´ìš©ì–´ êµ¬ë¶„**: ê¹€ì˜ìˆœ (2015). "í•œêµ­ì–´ ê¸°ëŠ¥ì–´ ì—°êµ¬"
- **í•œêµ­ì–´ í†µê³„ì  íŠ¹ì„±**: ì¡°ë‚¨í˜¸ (2003). "í˜„ëŒ€ í•œêµ­ì–´ ì‚¬ìš© ë¹ˆë„ ì¡°ì‚¬"

### ê´€ë ¨ íŒŒì¼

- `backend/rag/idf_stats.py`: IDF í†µê³„ êµ¬í˜„
- `backend/rag/two_stage_retrieval.py`: 2ë‹¨ê³„ ê²€ìƒ‰ êµ¬í˜„
- `backend/rag/query_rewriter.py`: ì§ˆì˜ ì¬ì‘ì„± ë¡œì§
- `backend/schemas.py`: API ìŠ¤í‚¤ë§ˆ ì •ì˜

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê¸°ëŠ¥ ì™„ì„±ë„

- [x] ì •ì›”ëŒ€ë³´ë¦„ ì§ˆì˜ ì •í™•ë„ (ì œ066í˜¸, ì œ116í˜¸ ëª¨ë‘ ê²€ìƒ‰)
- [x] í›„ì† ì§ˆë¬¸ ì»¨í…ìŠ¤íŠ¸ ìœ ì§€
- [x] ì£¼ì œ ì „í™˜ ìë™ ê°ì§€
- [x] ì¶œì²˜ ë©”íƒ€ë°ì´í„° ì™„ì „ì„±
- [x] í•˜ë“œì½”ë”© ì œê±° (ìˆœìˆ˜ í†µê³„ì  ë°©ë²•)

### ì½”ë“œ í’ˆì§ˆ

- [x] ëª¨ë“ˆí™” ë° ì¬ì‚¬ìš©ì„±
- [x] ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°±
- [x] ë¡œê¹… ë° ë””ë²„ê¹… ì§€ì›
- [x] ë¬¸ì„œí™” (docstring)
- [x] íƒ€ì… íŒíŠ¸

### í…ŒìŠ¤íŠ¸

- [x] ì •ì›”ëŒ€ë³´ë¦„ ì‹œë‚˜ë¦¬ì˜¤
- [x] í›„ì† ì§ˆë¬¸ ì‹œë‚˜ë¦¬ì˜¤
- [x] ì£¼ì œ ì „í™˜ ì‹œë‚˜ë¦¬ì˜¤
- [x] ì¶œì²˜ ë©”íƒ€ë°ì´í„° ê²€ì¦

---

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„ (ì„ íƒì‚¬í•­)

1. **Golden QA í‰ê°€ ì‹¤í–‰**
   ```bash
   make qa
   ```

2. **ë³€ê²½ì‚¬í•­ ì»¤ë°‹**
   ```bash
   git add backend/rag/idf_stats.py
   git add backend/rag/two_stage_retrieval.py
   git add backend/rag/query_rewriter.py
   git add backend/rag/doc_scope_resolver.py
   git add backend/main.py
   git add backend/schemas.py
   git commit -m "feat: implement statistical function word filtering and two-stage retrieval"
   ```

3. **GitHub ì´ìŠˆ ìƒì„±**
   - ë³€ê²½ì‚¬í•­ ë¬¸ì„œí™”
   - ì´ì „ í•˜ë“œì½”ë”© ì œê±° ì‘ì—…ê³¼ ì—°ê³„

---

**ì™„ë£Œ ë‚ ì§œ**: 2025ë…„ 10ì›” 1ì¼
**ìƒíƒœ**: âœ… ëª¨ë“  ìš”êµ¬ì‚¬í•­ ì™„ë£Œ
